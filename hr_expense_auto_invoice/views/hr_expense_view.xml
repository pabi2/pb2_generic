<?xml version="1.0" encoding="utf-8"?>

<openerp>
<data>

    <record id="view_expenses_form" model="ir.ui.view">
        <field name="name">view.expenses.form</field>
        <field name="model">hr.expense.expense</field>
        <field name="inherit_id" ref="hr_expense.view_expenses_form"/>
        <field name="arch" type="xml">
            <button name="draft" position="replace" />
            <button name="done" position="replace" >
                <button name="%(action_expense_create_supplier_invoice)d" states="accepted" string="Create Supplier Invoice" type="action"
                        groups="account.group_account_invoice" class="oe_highlight"/>
            </button>
            <field name="name" position="after">
                <field name="pay_to" />
                <field name="partner_id" attrs="{'invisible': [('pay_to', '!=', 'supplier')],
                                                'required': [('pay_to', '=', 'supplier')]}"/> 
            </field>
            <xpath expr='/form/sheet/notebook/page/field/tree/field[@name="total_amount"]' position="before">
                <field name="tax_ids" widget="many2many_tags" />
            </xpath>
            <xpath expr='/form/sheet/notebook/page/field/tree/field[@name="total_amount"]' position="after">
                <field name="pay_to" invisible="1"/>
                <button name="%(action_expense_line_tax_info)d"
                        type="action"
                        string="Add Vat Info"
                        icon="gtk-ok"
                        attrs="{'invisible': [('pay_to', '!=', 'employee')]}"/>
            </xpath>
            <xpath expr="//button[@name='action_view_move']" position="attributes">
                <attribute name="states"></attribute>
                <attribute name="attrs">{'invisible': ['|',('account_move_id', '=', False), ('state', 'not in', ('done', 'paid'))]}</attribute>
            </xpath>
            <xpath expr='/form/sheet/notebook/page/field/form/group//field[@name="date_value"]' position="before">
                <field name="tax_ids" widget="many2many_tags" />
            </xpath>
            <xpath expr='/form/sheet/notebook/page[@string="Accounting"]/group/group/field[@name="account_move_id"]' position="before">
                <field name="invoice_id" />
                <field name="date_invoice" />
            </xpath>
            <xpath expr="//page[1]" position="after">
                <page string="VAT Info" attrs="{'invisible': [('pay_to', '!=', 'employee')]}">
                    <field name="vat_expense_line_ids">
                        <tree string="Vat Info" editable="bottom" create="false" delete="false">
                            <field name="date_invoice"/> 
                            <field name="invoice_number"/>
                            <field name="supplier_name" string="Supplier Text"/> 
                            <field name="expense_partner_id" domain="[('supplier', '=', True)]" string="Supplier ID"/>
                            <field name="supplier_vat"/>
                            <field name="supplier_taxbranch"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

</data>
</openerp>
